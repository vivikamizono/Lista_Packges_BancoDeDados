CREATE OR REPLACE PACKAGE PKG_DISCIPLINA AS
    -- Procedure para cadastro de disciplina
    PROCEDURE CADASTRAR_DISCIPLINA(
        P_NOME IN VARCHAR2,
        P_DESCRICAO IN VARCHAR2,
        P_CARGA_HORARIA IN NUMBER
    );

    -- Cursor para total de alunos por disciplina
    CURSOR CURSOR_TOTAL_ALUNOS_DISCIPLINA IS
        SELECT D.NOME, COUNT(M.ID_ALUNO) AS TOTAL_ALUNOS
        FROM DISCIPLINAS D
        JOIN MATRICULAS M ON D.ID_DISCIPLINA = M.ID_DISCIPLINA
        GROUP BY D.NOME
        HAVING COUNT(M.ID_ALUNO) > 10;

    -- Cursor para m√©dia de idade por disciplina
    CURSOR CURSOR_MEDIA_IDADE(P_ID_DISCIPLINA IN NUMBER) IS
        SELECT AVG(TRUNC(MONTHS_BETWEEN(SYSDATE, A.DATA_NASCIMENTO) / 12)) AS MEDIA_IDADE
        FROM ALUNOS A
        JOIN MATRICULAS M ON A.ID_ALUNO = M.ID_ALUNO
        WHERE M.ID_DISCIPLINA = P_ID_DISCIPLINA;

    -- Procedure para listar alunos de uma disciplina
    PROCEDURE LISTAR_ALUNOS_DISCIPLINA(P_ID_DISCIPLINA IN NUMBER);
END PKG_DISCIPLINA;
/

CREATE OR REPLACE PACKAGE BODY PKG_DISCIPLINA AS
    -- Procedure de cadastro de disciplina
    PROCEDURE CADASTRAR_DISCIPLINA(
        P_NOME IN VARCHAR2,
        P_DESCRICAO IN VARCHAR2,
        P_CARGA_HORARIA IN NUMBER
    ) IS
    BEGIN
        INSERT INTO DISCIPLINAS (NOME, DESCRICAO, CARGA_HORARIA)
        VALUES (P_NOME, P_DESCRICAO, P_CARGA_HORARIA);

        DBMS_OUTPUT.PUT_LINE('Disciplina cadastrada com sucesso: ' || P_NOME);
    END CADASTRAR_DISCIPLINA;

    -- Procedure para listar alunos de uma disciplina
    PROCEDURE LISTAR_ALUNOS_DISCIPLINA(P_ID_DISCIPLINA IN NUMBER) IS
        CURSOR_ALUNOS IS
            SELECT A.NOME
            FROM ALUNOS A
            JOIN MATRICULAS M ON A.ID_ALUNO = M.ID_ALUNO
            WHERE M.ID_DISCIPLINA = P_ID_DISCIPLINA;
        V_NOME ALUNOS.NOME%TYPE;
    BEGIN
        OPEN CURSOR_ALUNOS;
        LOOP
            FETCH CURSOR_ALUNOS INTO V_NOME;
            EXIT WHEN CURSOR_ALUNOS%NOTFOUND;
            DBMS_OUTPUT.PUT_LINE('Aluno: ' || V_NOME);
        END LOOP;
        CLOSE CURSOR_ALUNOS;
    END LISTAR_ALUNOS_DISCIPLINA;
END PKG_DISCIPLINA;
/
